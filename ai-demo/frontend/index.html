<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UAEU Library AI Assistant</title>
  <style>
    :root {
      --uaeu-red: #d71920;
      --uaeu-bg: #f4f4f4;
      --uaeu-light: #ffffff;
      --uaeu-text: #222;
      --link-blue: #1a0dab;
      --sidebar-width: 280px;
    }

    body.dark {
      --uaeu-bg: #1f1f1f;
      --uaeu-light: #2a2a2a;
      --uaeu-text: #e6e6e6;
      --link-blue: #7aa2ff;
    }

    body {
      margin: 0;
      background: var(--uaeu-bg);
      color: var(--uaeu-text);
      font-family: "Arial", sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* HEADER */
    .header {
      background: var(--uaeu-red);
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      color: white;
      font-size: 20px;
      z-index: 10;
      transition: all 0.3s ease;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo { height: 50px; }

    .menu-btn {
      font-size: 28px;
      cursor: pointer;
      background: rgba(255,255,255,0.2);
      padding: 5px 12px;
      border-radius: 6px;
      font-weight: bold;
      line-height: 1;
    }
    .menu-btn:hover { opacity: 0.8; }

    .control-btn {
      background: white;
      border: none;
      padding: 6px 14px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      color: var(--uaeu-red);
      margin-left: 5px;
    }
    body.dark .control-btn { background: #333; color: white; }

    /* SIDEBAR */
    .sidebar {
      position: fixed;
      top: 0;
      bottom: 0;
      width: var(--sidebar-width);
      background: var(--uaeu-light);
      box-shadow: 2px 0 10px rgba(0,0,0,0.2);
      z-index: 999;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      padding-top: 70px;
      display: flex;
      flex-direction: column;
    }
    .sidebar.open { transform: translateX(0); }

    .sidebar-title {
      font-size: 20px;
      font-weight: bold;
      padding: 15px 20px;
      border-bottom: 2px solid #eee;
    }

    .sidebar-link {
      padding: 15px 20px;
      font-size: 17px;
      font-weight: bold;
      border-bottom: 1px solid #eee;
      text-decoration: none;
      color: var(--uaeu-text);
      display: block;
    }
    .sidebar-link:hover { background: rgba(0,0,0,0.05); }

    .close-sidebar {
      position: absolute; top: 18px; right: 15px;
      font-size: 25px; cursor: pointer; color: #555;
    }

    /* CHAT AREA */
    .chat-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-bottom: 100px;
    }

    .msg {
      max-width: 85%;
      padding: 12px;
      border-radius: 12px;
      line-height: 1.5;
      font-size: 16px;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .msg.user {
      background: var(--uaeu-red);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 0;
    }

    .msg.ai {
      background: var(--uaeu-light);
      align-self: flex-start;
      border: 1px solid #ccc;
      border-bottom-left-radius: 0;
    }

    .msg a { color: var(--link-blue); font-weight: bold; text-decoration: underline; }

    /* INPUT BAR */
    .input-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--uaeu-light);
      border-top: 3px solid var(--uaeu-red);
      padding: 12px;
      display: flex;
      gap: 10px;
      box-sizing: border-box;
      z-index: 100;
      height: 70px;
      align-items: center;
    }

    textarea {
      flex: 1;
      height: 40px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      background: var(--uaeu-bg);
      color: var(--uaeu-text);
      font-size: 16px;
      resize: none;
      outline: none;
      font-family: "Arial", sans-serif;
    }

    button.send-btn {
      background: var(--uaeu-red);
      color: white;
      border: none;
      padding: 0 20px;
      height: 42px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }
    button.send-btn:hover { opacity: 0.9; }

    /* ABOUT MODAL */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.45);
      display: none; align-items: center; justify-content: center;
      z-index: 2000;
    }
    .modal-box {
      background: var(--uaeu-light);
      padding: 25px 30px;
      border-radius: 12px;
      width: 420px;
      border: 2px solid var(--uaeu-red);
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      position: relative;
    }
    .modal-box h2 { color: var(--uaeu-red); margin-top: 0; }
    .modal-box a { color: var(--link-blue); text-decoration: underline; font-weight: bold; }

    .close-modal {
      position: absolute; top: 10px; right: 15px;
      font-size: 22px; cursor: pointer; color: #444; font-weight: bold;
    }

    /* ARABIC RTL */
    .rtl { direction: rtl; }
    .rtl .header { flex-direction: row-reverse; }
    .rtl .header-left { flex-direction: row-reverse; }
    .rtl .msg.user { align-self: flex-start; border-bottom-right-radius: 12px; border-bottom-left-radius: 0; }
    .rtl .msg.ai { align-self: flex-end; border-bottom-left-radius: 12px; border-bottom-right-radius: 0; }

    .rtl .sidebar { transform: translateX(100%); right: 0; left: auto; }
    .rtl .sidebar.open { transform: translateX(0); }
    .rtl .close-sidebar { left: 15px; right: auto; }

  </style>
</head>
<body>

  <div class="header">
    <div class="header-left">
      <div class="menu-btn" onclick="toggleMenu()">|||</div>
      <img src="logo.jpg" class="logo" alt="UAEU">
      <span id="appTitle">UAEU Library AI Assistant</span>
    </div>
    <div>
      <button class="control-btn" onclick="toggleLang()">AR / EN</button>
      <button class="control-btn" onclick="toggleDark()">ğŸŒ™ / â˜€ï¸</button>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="close-sidebar" onclick="toggleMenu()">âœ–</div>
    <div class="sidebar-title" id="sidebarTitle">ğŸ”— Quick Access</div>

    <a href="https://www.uaeu.ac.ae/en/library/" target="_blank" class="sidebar-link" id="linkLib">ğŸ“š Library Website</a>
    <a href="https://www.uaeu.ac.ae/en/library/libraryhours.shtml" target="_blank" class="sidebar-link" id="linkHours">â° Library Hours</a>
    <a href="https://www.uaeu.ac.ae/en/library/ask-us.shtml" target="_blank" class="sidebar-link" id="linkChat">ğŸ’¬ Live Help</a>

    <a href="https://uaeu.account.worldcat.org/account/checkouts" target="_blank" class="sidebar-link" id="linkAccount">ğŸ‘¤ My Library Account</a>

    <a href="#" onclick="toggleAbout(); return false;" class="sidebar-link" id="linkAbout">â„¹ï¸ About</a>
  </div>

  <div id="aboutModal" class="modal-overlay">
    <div class="modal-box">
      <div class="close-modal" onclick="toggleAbout()">âœ–</div>
      <h2 id="aboutTitle">About This Assistant</h2>
      <p id="aboutDesc1">This assistant uses <b>Gemini AI</b> to understand your question and recommend the best books.</p>
      <p id="aboutDesc2">It retrieves book information from the <b>UAEU OCLC Library System</b>.</p>
      <p>
        <span id="aboutDev">Developed by</span>
        <a href="https://www.linkedin.com/in/asadik-hamed-158937297/" target="_blank">Asadik Hamed</a>
      </p>
    </div>
  </div>

  <div id="chat" class="chat-container"></div>

  <div class="input-bar">
    <textarea id="msgInput" placeholder="Ask something about books..."
      onkeydown="if(event.key==='Enter' && !event.shiftKey){ event.preventDefault(); sendMessage(); }"></textarea>
    <button class="send-btn" onclick="sendMessage()">Send</button>
  </div>

<script>
let isArabic = false;

// --- LINKIFY HELPER ---
function linkify(text) {
  return text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
}

// --- TYPING EFFECT ---
function typeMessage(element, text) {
  const htmlContent = linkify(text);
  const tempDiv = document.createElement("div");
  tempDiv.innerHTML = htmlContent;
  const nodes = Array.from(tempDiv.childNodes);

  element.innerHTML = "";

  let i = 0;
  function typeNode() {
    if (i >= nodes.length) return;
    const node = nodes[i];
    if (node.nodeType === Node.TEXT_NODE) {
      const chars = node.textContent.split("");
      let c = 0;
      function typeChar() {
        if (c < chars.length) {
          element.appendChild(document.createTextNode(chars[c]));
          c++;
          setTimeout(typeChar, 8);
        } else {
          i++;
          typeNode();
        }
      }
      typeChar();
    } else {
      element.appendChild(node.cloneNode(true));
      i++;
      setTimeout(typeNode, 30);
    }
  }
  typeNode();
}

// --- UI LOGIC ---
function toggleMenu() {
  document.getElementById("sidebar").classList.toggle("open");
}

function toggleAbout() {
  const modal = document.getElementById("aboutModal");
  modal.style.display = (modal.style.display === "flex") ? "none" : "flex";
  toggleMenu();
}

function toggleDark() {
  document.body.classList.toggle("dark");
}

function toggleLang() {
  isArabic = !isArabic;
  const body = document.body;
  const input = document.getElementById("msgInput");
  const chat = document.getElementById("chat");

  // Elements to translate
  const title = document.getElementById("appTitle");
  const sbTitle = document.getElementById("sidebarTitle");
  const lLib = document.getElementById("linkLib");
  const lHours = document.getElementById("linkHours");
  const lChat = document.getElementById("linkChat");
  const lAccount = document.getElementById("linkAccount"); // NEW
  const lAbout = document.getElementById("linkAbout");

  // About Section IDs
  const abtTitle = document.getElementById("aboutTitle");
  const abtDesc1 = document.getElementById("aboutDesc1");
  const abtDesc2 = document.getElementById("aboutDesc2");
  const abtDev = document.getElementById("aboutDev");

  if (isArabic) {
    body.classList.add("rtl");
    input.placeholder = "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...";
    input.style.textAlign = "right";

    // TEXT TRANSLATION
    title.innerText = "Ù…Ø³Ø§Ø¹Ø¯ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª";
    sbTitle.innerText = "ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©";
    lLib.innerText = "ğŸ“š Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…ÙƒØªØ¨Ø©";
    lHours.innerText = "â° Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙƒØªØ¨Ø©";
    lChat.innerText = "ğŸ’¬ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­ÙŠØ©";
    lAccount.innerText = "ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©"; // NEW ARABIC TEXT
    lAbout.innerText = "â„¹ï¸ Ø­ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯";

    // ABOUT TRANSLATION
    abtTitle.innerText = "Ø­ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ";
    abtDesc1.innerHTML = "ÙŠØ³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ <b>Gemini AI</b> Ù„ÙÙ‡Ù… Ø£Ø³Ø¦Ù„ØªÙƒ ÙˆØ§Ù‚ØªØ±Ø§Ø­ Ø£ÙØ¶Ù„ Ø§Ù„ÙƒØªØ¨.";
    abtDesc2.innerHTML = "ÙŠØ³ØªÙ…Ø¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù† <b>Ù†Ø¸Ø§Ù… ÙÙ‡Ø±Ø³ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© (OCLC)</b>.";
    abtDev.innerText = "ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø©";

    // LINK TRANSLATION (CHANGE URLS TO ARABIC)
    lLib.href = "https://www.uaeu.ac.ae/ar/library/";
    lHours.href = "https://www.uaeu.ac.ae/ar/library/libraryhours.shtml";

  } else {
    body.classList.remove("rtl");
    input.placeholder = "Ask something about books...";
    input.style.textAlign = "left";

    // TEXT TRANSLATION
    title.innerText = "UAEU Library AI Assistant";
    sbTitle.innerText = "ğŸ”— Quick Access";
    lLib.innerText = "ğŸ“š Library Website";
    lHours.innerText = "â° Library Hours";
    lChat.innerText = "ğŸ’¬ Live Help";
    lAccount.innerText = "ğŸ‘¤ My Library Account"; // NEW ENGLISH TEXT
    lAbout.innerText = "â„¹ï¸ About";

    // ABOUT TRANSLATION
    abtTitle.innerText = "About This Assistant";
    abtDesc1.innerHTML = "This assistant uses <b>Gemini AI</b> to understand your question and recommend the best books.";
    abtDesc2.innerHTML = "It retrieves book information from the <b>UAEU OCLC Library System</b>.";
    abtDev.innerText = "Developed by";

    // LINK TRANSLATION (CHANGE URLS TO ENGLISH)
    lLib.href = "https://www.uaeu.ac.ae/en/library/";
    lHours.href = "https://www.uaeu.ac.ae/en/library/libraryhours.shtml";
  }

  chat.innerHTML = "";
  showWelcome();
}

// --- APPEND MESSAGE ---
function appendMessage(text, sender, animate = false) {
  const chat = document.getElementById("chat");
  const bubble = document.createElement("div");
  bubble.className = "msg " + sender;

  chat.appendChild(bubble);

  if (animate && sender === "ai") {
    typeMessage(bubble, text);
  } else {
    bubble.innerHTML = linkify(text);
  }
  setTimeout(() => chat.scrollTop = chat.scrollHeight, 100);
}

function showWelcome() {
  const msg = isArabic
    ? "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ"
    : "Hello! I'm the UAEU Library Assistant. How can I help you today?";
  appendMessage(msg, "ai", true);
}

// --- SEND LOGIC ---
async function sendMessage() {
  const input = document.getElementById("msgInput");
  const text = input.value.trim();
  if (!text) return;

  appendMessage(text, "user");
  input.value = "";

  const chat = document.getElementById("chat");

  // âœ… PROCESS STATUS BUBBLE
  const status = document.createElement("div");
  status.className = "msg ai";
  status.innerText = isArabic
    ? "ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©..."
    : "ğŸ” Searching UAEU Library...";
  chat.appendChild(status);
  chat.scrollTop = chat.scrollHeight;

  try {
    // Step 1 â€“ searching
    await new Promise(r => setTimeout(r, 500));

    status.innerText = isArabic
      ? "ğŸ“š ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØªØ¨ Ø°Ø§Øª ØµÙ„Ø©..."
      : "ğŸ“š Found relevant books...";

    // API call
    const res = await fetch("http://127.0.0.1:8000/ai-search", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: text, limit: 5 })
    });

    const data = await res.json();

    // Step 2 â€“ AI analysis
    status.innerText = isArabic
      ? "ğŸ§  ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†..."
      : "ğŸ§  Analyzing and recommending best titles...";

    await new Promise(r => setTimeout(r, 700));

    // Final answer (keep typing effect)
    chat.removeChild(status);
    appendMessage(data.ai_response, "ai", true);

  } catch (e) {
    chat.removeChild(status);
    appendMessage(
      isArabic ? "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„." : "âŒ Connection error.",
      "ai"
    );
  }
}


window.onload = showWelcome;
</script>

</body>
</html>

